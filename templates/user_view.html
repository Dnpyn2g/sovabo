{% extends "base.html" %}

{% block title %}–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ u.user_id }} - CRM{% endblock %}

{% block content %}
<div class="card">
    <h2>üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {{ u.user_id }}</h2>
    <p><strong>Username:</strong> {{ u.username or '‚Äî' }}</p>
    <p><strong>–ë–∞–ª–∞–Ω—Å:</strong> {{ "%.2f"|format(u.balance or 0) }} ‚ÇΩ</p>
    <p><strong>–†–µ—Ñ–µ—Ä–µ—Ä:</strong> {{ u.referrer_id or '‚Äî' }}</p>
    <p><strong>–ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ —Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤:</strong> {{ "%.2f"|format(u.ref_earned or 0) }} ‚ÇΩ</p>
    <p><strong>–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å—Ç–∞–≤–∫–∞:</strong> {{ u.ref_rate or 0 }}%</p>
    
    <form method="post" action="{{ url_for('users_balance_update', user_id=u.user_id) }}" style="margin-top: 1rem;">
        <div class="form-group">
            <label>–ò–∑–º–µ–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</label>
            <input type="number" name="delta" step="0.01" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É (+ –∏–ª–∏ -)">
        </div>
        <button type="submit" class="btn btn-success">üí∞ –ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
    </form>
</div>

<div class="card">
    <h2>üì¶ –ó–∞–∫–∞–∑—ã ({{ orders|length }})</h2>
    {% if orders %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>–¢–∏–ø</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–°—É–º–º–∞</th>
                <th>–î–∞—Ç–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for o in orders %}
            <tr>
                <td><a href="{{ url_for('orders_view', order_id=o.id) }}">{{ o.id }}</a></td>
                <td>{{ o.order_type }}</td>
                <td>{{ o.status }}</td>
                <td>{{ "%.2f"|format(o.amount or 0) }} ‚ÇΩ</td>
                <td>{{ o.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</p>
    {% endif %}
</div>

<div class="card">
    <h2>üí∞ –î–µ–ø–æ–∑–∏—Ç—ã ({{ deps|length }})</h2>
    {% if deps %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>–°—É–º–º–∞</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–∞—Ç–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for d in deps %}
            <tr>
                <td>{{ d.id }}</td>
                <td>{{ "%.2f"|format(d.amount or 0) }} ‚ÇΩ</td>
                <td>{{ d.status }}</td>
                <td>{{ d.created_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>–î–µ–ø–æ–∑–∏—Ç–æ–≤ –Ω–µ—Ç</p>
    {% endif %}
</div>

<a href="{{ url_for('users_list') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
{% endblock %}
