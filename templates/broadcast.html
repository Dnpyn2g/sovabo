{% extends "base.html" %}

{% block title %}–†–∞—Å—Å—ã–ª–∫–∞ - CRM{% endblock %}

{% block content %}
<div class="card">
    <h2>üì¢ –†–∞—Å—Å—ã–ª–∫–∞</h2>
    
    {% if state.running %}
    <div class="flash info">
        ‚è≥ –†–∞—Å—Å—ã–ª–∫–∞ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ... ({{ state.sent }} / {{ state.total }} –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ)
    </div>
    {% endif %}
    
    {% if state.finished_at %}
    <div style="background: #f8f9fa; padding: 1rem; border-radius: 4px; margin-bottom: 1rem;">
        <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è —Ä–∞—Å—Å—ã–ª–∫–∞:</strong></p>
        <p>–ù–∞—á–∞–ª–æ: {{ state.started_at }}</p>
        <p>–û–∫–æ–Ω—á–∞–Ω–∏–µ: {{ state.finished_at }}</p>
        <p>–í—Å–µ–≥–æ: {{ state.total }}, –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: {{ state.sent }}, –ü—Ä–æ–ø—É—â–µ–Ω–æ: {{ state.skipped }}, –û—à–∏–±–æ–∫: {{ state.failed }}</p>
        {% if state.last_error %}
        <p style="color: #e74c3c;">–ü–æ—Å–ª–µ–¥–Ω—è—è –æ—à–∏–±–∫–∞: {{ state.last_error }}</p>
        {% endif %}
    </div>
    {% endif %}
    
    <form method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label>–°–æ–æ–±—â–µ–Ω–∏–µ (HTML –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è)</label>
            <textarea name="message" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è..."></textarea>
        </div>
        
        <div class="form-group">
            <label>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <input type="file" name="image" accept="image/*">
        </div>
        
        <div class="form-group">
            <label>–ö–Ω–æ–ø–∫–∏ –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é</label>
            {% for text, callback in menu_buttons %}
            <label style="display: block; margin-bottom: 0.5rem;">
                <input type="checkbox" name="buttons" value="{{ callback }}"> {{ text }}
            </label>
            {% endfor %}
        </div>
        
        <div class="form-group">
            <label>–ü—Ä–æ–º–æ–∫–æ–¥ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
            <select name="promo">
                <option value="">‚Äî –ë–µ–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞ ‚Äî</option>
                {% for promo in promocodes %}
                <option value="{{ promo.code }}">{{ promo.code }} ({{ promo.discount_type }}, {{ promo.discount_value }})</option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit" class="btn btn-success" {% if state.running %}disabled{% endif %}>üì§ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º</button>
    </form>
</div>
{% endblock %}
