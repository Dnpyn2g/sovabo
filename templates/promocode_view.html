{% extends "base.html" %}

{% block title %}–ü—Ä–æ–º–æ–∫–æ–¥ {{ promo.code }} - CRM{% endblock %}

{% block content %}
<div class="card">
    <h2>üéüÔ∏è –ü—Ä–æ–º–æ–∫–æ–¥: {{ promo.code }}</h2>
    <p><strong>ID:</strong> {{ promo.id }}</p>
    <p><strong>–¢–∏–ø —Å–∫–∏–¥–∫–∏:</strong> {{ promo.discount_type }}</p>
    <p><strong>–ó–Ω–∞—á–µ–Ω–∏–µ:</strong> {{ promo.discount_value }}</p>
    <p><strong>–ú–∞–∫—Å. –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π:</strong> {{ promo.max_uses or '‚àû' }}</p>
    <p><strong>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ:</strong> {{ usage|length }}</p>
    <p><strong>–ê–∫—Ç–∏–≤–µ–Ω:</strong> {{ '‚úÖ –î–∞' if promo.is_active else '‚ùå –ù–µ—Ç' }}</p>
    <p><strong>–°–æ–∑–¥–∞–Ω:</strong> {{ promo.created_at }}</p>
    
    <form method="post" style="display: inline;">
        {% if promo.is_active %}
        <button type="submit" name="action" value="deactivate" class="btn btn-danger">üö´ –î–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        {% else %}
        <button type="submit" name="action" value="activate" class="btn btn-success">‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
        {% endif %}
        <button type="submit" name="action" value="delete" class="btn btn-danger" onclick="return confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥?')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
    </form>
</div>

<div class="card">
    <h3>üìä –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ({{ usage|length }})</h3>
    {% if usage %}
    <table>
        <thead>
            <tr>
                <th>User ID</th>
                <th>–°–∫–∏–¥–∫–∞</th>
                <th>–î–∞—Ç–∞</th>
            </tr>
        </thead>
        <tbody>
            {% for u in usage %}
            <tr>
                <td><a href="{{ url_for('users_view', user_id=u.user_id) }}">{{ u.user_id }}</a></td>
                <td>{{ "%.2f"|format(u.discount_applied) }} ‚ÇΩ</td>
                <td>{{ u.used_at }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>–ü—Ä–æ–º–æ–∫–æ–¥ –µ—â–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è</p>
    {% endif %}
</div>

<a href="{{ url_for('promocodes_list') }}" class="btn btn-secondary">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É</a>
{% endblock %}
